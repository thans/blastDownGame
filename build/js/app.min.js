!function(){me.debug=me.debug||{},debugPanel=me.plugin.Base.extend({GUID:null,area:{},rect:null,z:1/0,visible:!1,frameUpdateTime:0,frameDrawTime:0,version:"1.0.1",init:function(a,b){this.parent(),this.rect=new me.Rect(new me.Vector2d(0,0),me.video.getWidth(),35),this.GUID="debug-"+me.utils.createGUID(),this.name="me.debugPanel",this.isPersistent=!0,this.floating=!0,this.isRenderable=!0,this.alwaysUpdate=!0;var c=10;this.mod=1,me.game.viewport.width<500&&(c=7,this.mod=.7),this.font=new me.Font("courier",c,"white"),this.area.renderHitBox=new me.Rect(new me.Vector2d(160,5),15,15),this.area.renderVelocity=new me.Rect(new me.Vector2d(165,18),15,15),this.area.renderDirty=new me.Rect(new me.Vector2d(270,5),15,15),this.area.renderCollisionMap=new me.Rect(new me.Vector2d(270,18),15,15),this.help_str="(s)how/(h)ide",this.help_str_len=this.font.measureText(me.video.getSystemContext(),this.help_str).width,this.fps_str_len=this.font.measureText(me.video.getSystemContext(),"00/00 fps").width,this.memoryPositionX=2.2*this.font.measureText(me.video.getSystemContext(),"Draw   : ").width+310*this.mod,this.help_str="(s)how/(h)ide",this.help_str_len=this.font.measureText(me.video.getSystemContext(),this.help_str).width,this.fps_str_len=this.font.measureText(me.video.getSystemContext(),"00/00 fps").width,me.debug.displayFPS=!0,me.input.bindKey(a||me.input.KEY.S,"show",!1,!1),me.input.bindKey(b||me.input.KEY.H,"hide",!1,!1);var d=this;this.keyHandler=me.event.subscribe(me.event.KEYDOWN,function(a){"show"===a?d.show():"hide"===a&&d.hide()}),this.levelHandler=me.event.subscribe(me.event.LEVEL_LOADED,function(){var a=me.game.currentLevel.getLayerByName("collision");a&&a.setOpacity(me.debug.renderCollisionMap===!0?1:0)}),this.samples=[],this.patchSystemFn(),this.show()},patchSystemFn:function(){me.debug.renderHitBox=me.debug.renderHitBox||!1,me.debug.renderVelocity=me.debug.renderVelocity||!1,me.debug.renderCollisionMap=me.debug.renderCollisionMap||!1;var a=this;me.plugin.patch(me.timer,"update",function(a){this.parent(a),me.timer.countFPS()}),me.plugin.patch(me.game,"update",function(b){var c=window.performance.now();this.parent(b),a.frameUpdateTime=window.performance.now()-c}),me.plugin.patch(me.game,"draw",function(){var b=window.performance.now();this.parent(),a.frameDrawTime=window.performance.now()-b}),me.plugin.patch(me.SpriteObject,"draw",function(a){this.parent(a),me.debug.renderHitBox&&(a.strokeStyle="green",a.strokeRect(this.left,this.top,this.width,this.height))}),me.plugin.patch(me.ObjectEntity,"draw",function(a){if(this.parent(a),me.debug.renderHitBox&&this.shapes.length){var b=this.pos.x,c=this.pos.y;a.translate(b,c),this.getShape().draw(a,"red"),"Rectangle"!==this.getShape().shapeType&&this.getShape().getBounds().draw(a,"red"),a.translate(-b,-c)}if(me.debug.renderVelocity){var d=~~(this.pos.x+this.hWidth),e=~~(this.pos.y+this.hHeight);a.strokeStyle="blue",a.lineWidth=1,a.beginPath(),a.moveTo(d,e),a.lineTo(d+~~(this.vel.x*this.hWidth),e+~~(this.vel.y*this.hHeight)),a.stroke()}})},show:function(){this.visible||(me.input.registerPointerEvent("pointerdown",this.rect,this.onClick.bind(this),!0),me.game.world.addChild(this,1/0),this.visible=!0)},hide:function(){this.visible&&(me.input.releasePointerEvent("pointerdown",this.rect),me.game.world.removeChild(this),this.visible=!1)},update:function(){return me.input.isKeyPressed("show")?this.show():me.input.isKeyPressed("hide")&&this.hide(),!0},getBounds:function(){return this.rect},onClick:function(a){if(this.area.renderHitBox.containsPoint(a.gameX,a.gameY))me.debug.renderHitBox=!me.debug.renderHitBox;else if(this.area.renderCollisionMap.containsPoint(a.gameX,a.gameY)){var b=me.game.currentLevel.getLayerByName("collision");b&&(0===b.getOpacity()?(b.setOpacity(1),me.debug.renderCollisionMap=!0):(b.setOpacity(0),me.debug.renderCollisionMap=!1))}else this.area.renderVelocity.containsPoint(a.gameX,a.gameY)&&(me.debug.renderVelocity=!me.debug.renderVelocity);me.game.repaint()},drawMemoryGraph:function(a,b){if(window.performance&&window.performance.memory){var c=Number.prototype.round(window.performance.memory.usedJSHeapSize/1048576,2),d=Number.prototype.round(window.performance.memory.totalJSHeapSize/1048576,2),e=b-this.memoryPositionX;this.samples.shift(),this.samples[e]=c/d*25;for(var f=e;f>=0;f--){var g=b-(e-f);a.beginPath(),a.strokeStyle="lightblue",a.moveTo(g,30*this.mod),a.lineTo(g,(30-(this.samples[f]||0))*this.mod),a.stroke()}this.font.draw(a,"Heap : "+c+"/"+d+" MB",this.memoryPositionX,5*this.mod)}else this.font.draw(a,"Heap : ??/?? MB",this.memoryPositionX,5*this.mod)},draw:function(a){a.save(),a.globalAlpha=.5,a.fillStyle="black",a.fillRect(this.rect.left,this.rect.top,this.rect.width,this.rect.height),a.globalAlpha=1,this.font.draw(a,"#objects : "+me.game.world.children.length,5*this.mod,5*this.mod),this.font.draw(a,"#draws   : "+me.game.world.drawCount,5*this.mod,18*this.mod),this.font.draw(a,"?hitbox   ["+(me.debug.renderHitBox?"x":" ")+"]",100*this.mod,5*this.mod),this.font.draw(a,"?velocity ["+(me.debug.renderVelocity?"x":" ")+"]",100*this.mod,18*this.mod),this.font.draw(a,"?dirtyRect  [ ]",200*this.mod,5*this.mod),this.font.draw(a,"?col. layer ["+(me.debug.renderCollisionMap?"x":" ")+"]",200*this.mod,18*this.mod),this.font.draw(a,"Update : "+this.frameUpdateTime.toFixed(2)+" ms",310*this.mod,5*this.mod),this.font.draw(a,"Draw   : "+this.frameDrawTime.toFixed(2)+" ms",310*this.mod,18*this.mod);var b=this.rect.width-25;this.drawMemoryGraph(a,b-this.help_str_len),this.font.draw(a,this.help_str,b-this.help_str_len,18*this.mod);var c=""+me.timer.fps+"/"+me.sys.fps+" fps";this.font.draw(a,c,this.rect.width-this.fps_str_len-5,5*this.mod),a.restore()},onDestroyEvent:function(){this.hide(),me.input.unbindKey(me.input.KEY.S),me.input.unbindKey(me.input.KEY.H),me.event.unsubscribe(this.keyHandler),me.event.unsubscribe(this.levelHandler)}})}(window);var game={data:{score:0},onload:function(){return me.video.init("screen",960,640,!0,"auto")?("#debug"===document.location.hash&&window.onReady(function(){me.plugin.register.defer(this,debugPanel,"debug")}),me.sys.fps=30,me.audio.init("mp3,ogg"),me.loader.onload=this.loaded.bind(this),me.loader.preload(game.resources),void me.state.change(me.state.LOADING)):void alert("Your browser does not support HTML5 canvas.")},loaded:function(){me.state.set(me.state.MENU,new game.TitleScreen),me.state.set(me.state.PLAY,new game.PlayScreen),me.pool.register("mainPlayer",game.PlayerEntity),me.input.bindKey(me.input.KEY.LEFT,"left"),me.input.bindKey(me.input.KEY.RIGHT,"right"),me.input.bindKey(me.input.KEY.SPACE,"shoot"),me.state.change(me.state.PLAY)}};game.resources=[{name:"player",type:"image",src:"data/img/player_ship.png"},{name:"xlarge",type:"image",src:"data/img/xlarge_ship.png"},{name:"large",type:"image",src:"data/img/large_ship.png"},{name:"medium",type:"image",src:"data/img/medium_ship.png"},{name:"small",type:"image",src:"data/img/small_ship.png"},{name:"bullet",type:"image",src:"data/img/bullet_sprite.png"},{name:"test",type:"image",src:"data/img/test.png"},{name:"background",type:"image",src:"data/img/background.png"},{name:"sprites",type:"image",src:"data/sprites.png"},{name:"area51",type:"tmx",src:"data/map/area51.tmx"}],game.HUD=game.HUD||{},game.HUD.Container=me.ObjectContainer.extend({init:function(){this.parent(),this.isPersistent=!0,this.collidable=!1,this.z=1/0,this.name="HUD",this.addChild(new game.HUD.ScoreItem(5,5))}}),game.HUD.ScoreItem=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(a,b),10,10),this.score=-1,this.floating=!0},update:function(){return this.score!==game.data.score?(this.score=game.data.score,!0):!1},draw:function(){}}),game.Mothership=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.gravity=0,this.setVelocity(0,0)}}),game.Ship=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.gravity=0,this.setVelocity(0,0),this.numSteps=0,this.moveRight=!0},update:function(){this.numSteps%3==0&&(this.numSteps%192==0&&(this.moveRight=!this.moveRight,this.numSteps=0),this.moveRight?this.pos.x-=1:this.pos.x+=1),this.numSteps++}}),game.BulletEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.gravity=0,this.setVelocity(0,8)},update:function(){return this.pos.y<16&&me.game.world.removeChild(this),this.flipX(this.left),this.vel.y-=this.accel.y*me.timer.tick,this.updateMovement(),!0}}),game.PlayerEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),console.log(c),console.log(this),this.gravity=0,this.setVelocity(5,0)},update:function(a){if(me.input.isKeyPressed("left")?this.vel.x-=this.accel.x*me.timer.tick:me.input.isKeyPressed("right")?this.vel.x+=this.accel.x*me.timer.tick:this.vel.x=0,me.input.isKeyPressed("shoot")){console.log("this",this);var b=new game.BulletEntity(this.pos.x,this.pos.y,{height:16,image:"test",name:"shot",spriteheight:16,spritewidth:32,width:16});me.game.world.addChild(b,9)}return this.updateMovement(),0!=this.vel.x||0!=this.vel.y?(this.parent(a),!0):!0}}),game.PlayScreen=me.ScreenObject.extend({onResetEvent:function(){var a=32,b=960-2*a;me.levelDirector.loadLevel("area51"),game.data.score=0;var c=8,d=new game.Ship(320-a,32,{height:160,image:"xlarge",name:"mothership",spriteheight:160,spritewidth:320,width:320,z:c});me.game.world.addChild(d,c),c++;for(var e=6,f=b/e,g=64,h=0;e>h;h++){var i=new game.Ship(h*f+(f-g)/2,192,{height:g,image:"large",name:"feature"+h,spriteheight:g,spritewidth:g,width:g,z:c});me.game.world.addChild(i,c++)}c++;var j=3*e;f=b/j,g=32;for(var h=0;j>h;h++){var k=new game.Ship(h*f+(f-g)/2,288,{height:g,image:"medium",name:"story"+h,spriteheight:g,spritewidth:g,width:g,z:c});me.game.world.addChild(k,c++)}c++;var l=2*j;f=b/l,g=16;for(var h=0;l>h;h++){var k=new game.Ship(h*f+(f-g)/2,352,{height:g,image:"small",name:"task"+h,spriteheight:g,spritewidth:g,width:g,z:c});me.game.world.addChild(k,c++)}c++},onDestroyEvent:function(){}}),game.TitleScreen=me.ScreenObject.extend({onResetEvent:function(){},onDestroyEvent:function(){}});